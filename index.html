<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>To-Do List â€“ New Task</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- JSON-style variable data -->
  <script>
    const priorities = [
      { idPriority: 1, labelPriority: "Very Low"  },
      { idPriority: 2, labelPriority: "Low"       },
      { idPriority: 3, labelPriority: "Medium"    },
      { idPriority: 4, labelPriority: "High"      },
      { idPriority: 5, labelPriority: "Critical"  }
    ];

    const statuses = [
      { idStatus: 1, status: "not ready"   },
      { idStatus: 2, status: "in progress" },
      { idStatus: 3, status: "done"        }
    ];

    const colors = [
      { idColor: 1, colorTag: "Red"    },
      { idColor: 2, colorTag: "Green"  },
      { idColor: 3, colorTag: "Blue"   },
      { idColor: 4, colorTag: "Yellow" }
    ];

    const categories = [
      { idCategory: 1, category: "Home"       },
      { idCategory: 2, category: "Work"       },
      { idCategory: 3, category: "University" }
    ];
  </script>

  <style>
    :root {
      --bg: #f5f7fa;
      --card: #ffffff;
      --ink: #222;
      --muted: #666;
      --accent: #2563eb;
      --accent-soft: #e0edff;
      --border: #e1e4ea;
      --radius: 12px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 16px;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: var(--bg);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      color: var(--ink);
    }

    .page {
      width: 100%;
      max-width: 460px;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: 0 8px 24px rgba(0,0,0,0.08);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 16px 20px;
      background: var(--accent-soft);
      border-bottom: 1px solid var(--border);
    }

    header h1 { margin: 0; font-size: 1.2rem; }
    header p  { margin: 4px 0 0; font-size: 0.85rem; color: var(--muted); }

    main { padding: 20px; }

    form {
      display: grid;
      gap: 14px;
    }

    fieldset {
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px;
      margin: 0;
    }

    legend {
      padding: 0 6px;
      font-size: 0.85rem;
      color: var(--muted);
      font-weight: 600;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 8px;
    }

    label { font-weight: 500; font-size: 0.9rem; }

    input, select, textarea {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: #f9fafb;
      font: inherit;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(37,99,235,0.15);
      background: #fff;
    }

    textarea { min-height: 80px; resize: vertical; }

    .inline-grid {
      display: grid;
      gap: 12px;
    }

    @media (min-width: 480px) {
      .inline-grid { grid-template-columns: 1fr 1fr; }
    }

    .button-row {
      margin-top: 4px;
      display: flex;
      justify-content: flex-end;
    }

    button[type="button"] {
      width: 100%;
      padding: 10px;
      background: var(--accent);
      border: none;
      border-radius: 8px;
      font-weight: 600;
      color: #fff;
      cursor: pointer;
      letter-spacing: 0.02em;
    }

    button[type="button"]:hover {
      background: #1d4ed8;
      box-shadow: 0 6px 18px rgba(37,99,235,0.35);
    }

    footer {
      border-top: 1px solid var(--border);
      padding: 10px 20px 12px;
      font-size: 0.78rem;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      gap: 6px;
      flex-wrap: wrap;
    }
  </style>
</head>
<body>

<div class="page">
  <header>
    <h1>Task To-Do List</h1>
    <p>Create a new task for your personal to-do list.</p>
  </header>

  <main>
    <!-- id added for reset() and validity checking -->
    <form id="taskForm" action="#" method="post">

      <fieldset>
        <legend>Task details</legend>

        <div class="form-group">
          <label for="titleTask">Task title *</label>
          <input type="text" id="titleTask" placeholder="e.g. Chemistry lab report" required>
        </div>

        <div class="form-group">
          <label for="description">Description *</label>
          <textarea id="description" required></textarea>
        </div>

        <div class="form-group">
          <label for="dueDate">Due date *</label>
          <input type="date" id="dueDate" required>
        </div>
      </fieldset>

      <fieldset>
        <legend>Labels & Organization</legend>

        <div class="inline-grid">
          <!-- PRIORITY -->
          <div class="form-group">
            <label for="priority">Priority *</label>
            <select id="priority" required>
              <option value="">Select priority</option>
            </select>
          </div>
          <script>
            const prioritySelect = document.getElementById("priority");
            priorities.forEach(function (item, index) {
              const optionHTML = `<option value="${item.idPriority}">${item.labelPriority}</option>`;
              prioritySelect.insertAdjacentHTML("beforeend", optionHTML);
            });
          </script>

          <!-- STATUS -->
          <div class="form-group">
            <label for="status">Status *</label>
            <select id="status" required>
              <option value="">Select status</option>
            </select>
          </div>
          <script>
            const statusSelect = document.getElementById("status");
            statuses.forEach(function (item, index) {
              const optionHTML = `<option value="${item.idStatus}">${item.status}</option>`;
              statusSelect.insertAdjacentHTML("beforeend", optionHTML);
            });
          </script>
        </div>

        <div class="inline-grid">
          <!-- CATEGORY -->
          <div class="form-group">
            <label for="category">Category *</label>
            <select id="category" required>
              <option value="">Select category</option>
            </select>
          </div>
          <script>
            const categorySelect = document.getElementById("category");
            categories.forEach(function (item, index) {
              const optionHTML = `<option value="${item.idCategory}">${item.category}</option>`;
              categorySelect.insertAdjacentHTML("beforeend", optionHTML);
            });
          </script>

          <!-- COLOR -->
          <div class="form-group">
            <label for="color">Color tag</label>
            <select id="color">
              <option value="">Select color tag</option>
            </select>
          </div>
          <script>
            const colorSelect = document.getElementById("color");

            function colorCircle(name) {
              const c = name.toLowerCase();
              if (c === "red")    return "ðŸ”´";
              if (c === "green")  return "ðŸŸ¢";
              if (c === "blue")   return "ðŸ”µ";
              if (c === "yellow") return "ðŸŸ¡";
              return "âšª";
            }

            colors.forEach(function (item, index) {
              const dot = colorCircle(item.colorTag);
              const optionHTML = `<option value="${item.idColor}">${dot} ${item.colorTag}</option>`;
              colorSelect.insertAdjacentHTML("beforeend", optionHTML);
            });
          </script>
        </div>

        <div class="form-group">
          <label for="subtasks">Subtasks (optional)</label>
          <textarea id="subtasks" placeholder="Write subtasks here, one per line..."></textarea>
        </div>
      </fieldset>

      <div class="button-row">
        <!-- type=button + onclick -->
        <button type="button" onclick="saveTask()">Save task</button>
      </div>

    </form>
  </main>

  <footer>
    <span>Author: Nadir Azizov</span>
    <span>&copy; 2025 To-Do List, UFAZ FEWP Project</span>
    <p style="margin-top:12px; text-align:center;">
  <a href="task-summary.html">View task summary</a>
</p>

  </footer>
</div>

<!-- saveTask() -->
<script>
  function saveTask() {
    const form = document.getElementById("taskForm");

    // With type="button", we must check validity ourselves
    if (!form.checkValidity()) {
      form.reportValidity();   // shows browser validation messages
      return;
    }

    // Read form fields
    let titleTask   = document.getElementById("titleTask").value.trim();
    let description = document.getElementById("description").value.trim();
    let dueDate     = document.getElementById("dueDate").value;        // "YYYY-MM-DD"
    let priority    = document.getElementById("priority").value;
    let status      = document.getElementById("status").value;
    let category    = document.getElementById("category").value;
    let color       = document.getElementById("color").value;

    let subtasksRaw = document.getElementById("subtasks").value;

    console.log("Form values:", {
      titleTask, description, dueDate,
      priority, status, category, color, subtasksRaw
    });

    // Initialize task list from localStorage
    const STORAGE_KEY = "taskList";
    let taskList = [];

    const storedTasks = localStorage.getItem(STORAGE_KEY);
    if (storedTasks) {
      taskList = JSON.parse(storedTasks);
    }

    console.log("Existing task list:", taskList);

    // Create new task object
    const newNumber = taskList.length + 1;                 // auto-increment
    const idTask = String(newNumber).padStart(4, "0");     // "0001", "0002", ...

    // Build subtasks array from lines
    let subtasks = [];
    if (subtasksRaw.trim() !== "") {
      const lines = subtasksRaw.split("\n").filter(
        line => line.trim() !== ""
      );
      subtasks = lines.map(function(line, index) {
        const idsubTask = idTask + String(index + 1).padStart(2, "0");
        return {
          idsubTask: idsubTask,
          title: line.trim(),
          completed: false
        };
      });
    }

    const newTask = {
      idTask: idTask,
      titleTask: titleTask,
      description: description,
      priority: Number(priority),
      status: Number(status),
      color: color === "" ? null : Number(color),
      category: Number(category),
      createdAt: new Date().toISOString(),
      dueDate: dueDate ? dueDate + "T23:59:00Z" : "",
      subtasks: subtasks
    };

    console.log("New task object:", newTask);

    // Add task to list
    taskList.push(newTask);
    console.log("Updated task list:", taskList);

    // Save back to localStorage
    const jsonString = JSON.stringify(taskList);
    localStorage.setItem(STORAGE_KEY, jsonString);

    console.log("Saved in localStorage under key '" + STORAGE_KEY + "':", jsonString);

    // Reset form for a new task
    form.reset();
  }
</script>

</body>
</html>